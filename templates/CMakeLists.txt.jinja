cmake_minimum_required(VERSION 3.15)
project(CborGenerated C CXX)

# This CMakeLists.txt is generated into the output directory (e.g., build_path in tests).
# It defines a library for the generated CBOR code and links against tinycbor.
# It assumes tinycbor is already available in the CMake project where this is included.

# Add the generated C file to a library
add_library({{ generated_library_name }} STATIC {{ generated_c_file_name }})

# Link against tinycbor.
# We assume tinycbor is already configured and available as a target.
# If tinycbor is fetched via FetchContent in a parent CMakeLists.txt,
# its targets will be available.
target_link_libraries({{ generated_library_name }} PRIVATE tinycbor)

# Add include directories for the generated header and tinycbor
target_include_directories({{ generated_library_name }} PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR} # For cbor_generated.h (which is in the same dir as this CMakeLists.txt)
    $<TARGET_PROPERTY:tinycbor,INTERFACE_INCLUDE_DIRECTORIES> # For tinycbor headers
)

# Set properties for the generated library
set_target_properties({{ generated_library_name }} PROPERTIES
    POSITION_INDEPENDENT_CODE ON
)

{% if test_harness_c_file_name and test_harness_executable_name %}
# Add the test harness executable if specified
add_executable({{ test_harness_executable_name }} {{ test_harness_c_file_name }})

# Link the test harness against the generated CBOR library and tinycbor
target_link_libraries({{ test_harness_executable_name }} PRIVATE
    {{ generated_library_name }}
    tinycbor
)

# Add include directories for the test harness
target_include_directories({{ test_harness_executable_name }} PRIVATE
    ${CMAKE_CURRENT_SOURCE_DIR} # For cbor_generated.h
    $<TARGET_PROPERTY:tinycbor,INTERFACE_INCLUDE_DIRECTORIES> # For tinycbor headers
)
{% endif %}
